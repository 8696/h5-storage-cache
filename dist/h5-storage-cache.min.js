(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory();
	else if(typeof define === 'function' && define.amd)
		define("H5StorageCache", [], factory);
	else if(typeof exports === 'object')
		exports["H5StorageCache"] = factory();
	else
		root["H5StorageCache"] = factory();
})(window, function() {
return /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/index.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./package.json":
/*!**********************!*\
  !*** ./package.json ***!
  \**********************/
/*! exports provided: name, version, description, author, main, scripts, repository, files, license, devDependencies, dependencies, keywords, default */
/***/ (function(module) {

module.exports = JSON.parse("{\"name\":\"h5-storage-cache\",\"version\":\"1.0.0\",\"description\":\"Web local storage cache\",\"author\":\"long<204084802@qq.com>\",\"main\":\"./dist/h5-storage-cache.min.js\",\"scripts\":{\"test\":\"echo \\\"Error: no test specified\\\" && exit 1\",\"dev\":\"webpack -w --config build.config.js\",\"build\":\"webpack -p --config build.config.js\"},\"repository\":{\"type\":\"git\",\"url\":\"https://github.com/8696/h5-storage-cache\"},\"files\":[\"dist\"],\"license\":\"ISC\",\"devDependencies\":{\"@types/node\":\"^13.7.4\",\"babel-core\":\"^6.26.3\",\"babel-loader\":\"^7.1.4\",\"babel-polyfill\":\"^6.26.0\",\"babel-preset-env\":\"^1.7.0\",\"merge\":\"^1.2.1\",\"ts-loader\":\"^6.2.1\",\"typescript\":\"^3.7.4\",\"webpack\":\"^4.19.0\",\"webpack-cli\":\"^3.1.2\",\"webpack-merge\":\"^4.2.2\"},\"dependencies\":{},\"keywords\":[\"cache\",\"storage\",\"localStorage\",\"sessionStorage\"]}");

/***/ }),

/***/ "./src/h5-storage-cache.ts":
/*!*********************************!*\
  !*** ./src/h5-storage-cache.ts ***!
  \*********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var __importStar = undefined && undefined.__importStar || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) {
        if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    }result["default"] = mod;
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
var utils = __importStar(__webpack_require__(/*! ./utils */ "./src/utils.ts"));
var packageInfo = __webpack_require__(/*! ../package.json */ "./package.json");

var Data = function () {
    function Data(cacheInstance, key, value, expireTime) {
        _classCallCheck(this, Data);

        this.cacheInstance = cacheInstance;
        this.key = key;
        this.value = value;
        this.expireTime = expireTime;
    }

    _createClass(Data, [{
        key: "toStorageJson",
        value: function toStorageJson() {
            if (this.expireTime !== -1) {
                this.expireTime = new Date().getTime() + this.expireTime;
            }
            var json = JSON.parse(JSON.stringify(this));
            delete json.key;
            delete json.cacheInstance;
            json.saveTime = new Date().getTime();
            json.v = packageInfo.version;
            return JSON.stringify(json);
        }
    }, {
        key: "getValue",
        value: function getValue() {
            if (this.isExpire()) {
                return this.value;
            }
            return null;
        }
    }, {
        key: "isExpire",
        value: function isExpire() {
            var bool = new Date().getTime() < this.expireTime || this.expireTime === -1;
            if (!bool) {
                this.cacheInstance.remove(this.key);
            }
            return bool;
        }
    }]);

    return Data;
}();

var Cache = function () {
    function Cache(options) {
        _classCallCheck(this, Cache);

        var defaultConfig = {
            expireTime: -1,
            prefix: 'cache_',
            storage: window.localStorage
        };
        !options && (options = defaultConfig);
        this.storage = options.storage || window.localStorage;
        this.config = Object.assign(defaultConfig, options);
    }
    /**
     * @description 获取配置文件
     * */


    _createClass(Cache, [{
        key: "getConfig",
        value: function getConfig() {
            return this.config;
        }
    }, {
        key: "makeKey",
        value: function makeKey(inputKey) {
            return this.config.prefix + inputKey;
        }
    }, {
        key: "parseInputKey",
        value: function parseInputKey(storageKey) {
            return storageKey.replace(new RegExp("^" + this.config.prefix), '');
        }
    }]);

    return Cache;
}();

var H5StorageCache = function (_Cache) {
    _inherits(H5StorageCache, _Cache);

    function H5StorageCache(options) {
        _classCallCheck(this, H5StorageCache);

        var _this = _possibleConstructorReturn(this, (H5StorageCache.__proto__ || Object.getPrototypeOf(H5StorageCache)).call(this, options));

        _this.v = packageInfo.version;
        return _this;
    }

    _createClass(H5StorageCache, [{
        key: "set",
        value: function set(key, value, expireTime) {
            if (!['string'].includes(utils.valueType(key))) {
                throw new Error('Key can only be a \'string\'');
            }
            if (!['string', 'number', 'array', 'object'].includes(utils.valueType(value))) {
                throw new Error('Value can only be a \'string\'、' + ' \'number、\' \'object\' and \'array\'');
            }
            if (expireTime !== undefined) {
                if (!['number'].includes(utils.valueType(expireTime))) {
                    throw new Error('Expiration time can only be a \'number\'');
                }
            }
            !expireTime && (expireTime = this.config.expireTime);
            this.storage.setItem(this.makeKey(key), new Data(this, key, value, expireTime).toStorageJson());
        }
    }, {
        key: "get",
        value: function get(key) {
            if (!['string'].includes(utils.valueType(key))) {
                throw new Error('Key can only be a \'string\'');
            }
            var storageData = this.storage.getItem(this.makeKey(key));
            if (storageData === null) {
                return null;
            }
            var objStorageData = JSON.parse(storageData);
            return new Data(this, key, objStorageData.value, objStorageData.expireTime).getValue();
        }
    }, {
        key: "has",
        value: function has(key) {
            var storageData = this.storage.getItem(this.makeKey(key));
            if (storageData === null) {
                return false;
            }
            var objStorageData = JSON.parse(storageData);
            return new Data(this, key, objStorageData.value, objStorageData.expireTime).isExpire();
        }
    }, {
        key: "isExpire",
        value: function isExpire(key) {
            var storageData = this.storage.getItem(this.makeKey(key));
            if (storageData === null) {
                return false;
            }
            var objStorageData = JSON.parse(storageData);
            return new Data(this, key, objStorageData.value, objStorageData.expireTime).isExpire();
        }
    }, {
        key: "remove",
        value: function remove(key) {
            if (!['string'].includes(utils.valueType(key))) {
                throw new Error('Key can only be a \'string\'');
            }
            this.storage.removeItem(this.makeKey(key));
        }
    }, {
        key: "clear",
        value: function clear() {
            var _this2 = this;

            var keys = this.getKeys();
            keys.forEach(function (key) {
                _this2.storage.removeItem(key);
            });
        }
    }, {
        key: "getLength",
        value: function getLength() {
            return this.getKeys().length;
        }
    }, {
        key: "getKeys",
        value: function getKeys() {
            var keys = [];
            for (var i = 0; i < this.storage.length; i++) {
                var key = this.storage.key(i);
                if (key !== null && new RegExp("^" + this.config.prefix).test(key)) {
                    keys.push(key);
                }
            }
            return keys;
        }
    }, {
        key: "getAll",
        value: function getAll() {
            var _this3 = this;

            var keys = this.getKeys();
            var array = [];
            keys.forEach(function (key) {
                key = _this3.parseInputKey(key);
                var value = _this3.get(key);
                if (value !== null) {
                    array.push({
                        key: key,
                        value: value
                    });
                }
            });
            return array;
        }
    }, {
        key: "clearExpire",
        value: function clearExpire() {
            var _this4 = this;

            var keys = this.getKeys();
            keys.forEach(function (key) {
                key = key.replace(new RegExp("^" + _this4.config.prefix), '');
                if (!_this4.isExpire(key)) {
                    _this4.remove(key);
                }
            });
        }
    }, {
        key: "getInfo",
        value: function getInfo(key) {
            if (!['string'].includes(utils.valueType(key))) {
                throw new Error('Key can only be a \'string\'');
            }
            var has = this.has(key);
            if (!has) {
                return null;
            }
            var storageData = this.storage.getItem(this.makeKey(key));
            if (storageData === null) {
                return null;
            }
            var objStorageData = JSON.parse(storageData);
            objStorageData.key = key;
            objStorageData.storageKey = this.makeKey(key);
            //
            var v = objStorageData.v;
            delete objStorageData.v;
            objStorageData.saveTimeVisual = utils.parseDateTime({
                format: 'y-m-d h:i:s',
                timestamp: objStorageData.saveTime
            });
            objStorageData.expireTimeVisual = objStorageData.expireTime === -1 ? -1 : utils.parseDateTime({
                format: 'y-m-d h:i:s',
                timestamp: objStorageData.expireTime
            });
            objStorageData.v = v;
            return objStorageData;
        }
    }]);

    return H5StorageCache;
}(Cache);

exports.default = H5StorageCache;

/***/ }),

/***/ "./src/index.js":
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _index = __webpack_require__(/*! ./index.ts */ "./src/index.ts");

var _index2 = _interopRequireDefault(_index);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

module.exports = _index2.default;

/***/ }),

/***/ "./src/index.ts":
/*!**********************!*\
  !*** ./src/index.ts ***!
  \**********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var __importDefault = undefined && undefined.__importDefault || function (mod) {
    return mod && mod.__esModule ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
var h5_storage_cache_1 = __importDefault(__webpack_require__(/*! ./h5-storage-cache */ "./src/h5-storage-cache.ts"));
exports.default = h5_storage_cache_1.default;

/***/ }),

/***/ "./src/utils.ts":
/*!**********************!*\
  !*** ./src/utils.ts ***!
  \**********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", { value: true });
function valueType(value) {
    var type = {
        '[object Number]': 'number',
        '[object String]': 'string',
        '[object Array]': 'array',
        '[object Object]': 'object',
        '[object Function]': 'function',
        '[object Undefined]': 'undefined',
        '[object Null]': 'null',
        '[object Boolean]': 'boolean',
        '[object Set]': 'set',
        '[object Map]': 'map'
    };
    return type[Object.prototype.toString.call(value)];
}
exports.valueType = valueType;
function parseDateTime(options) {
    // @ts-ignore
    !options.format && (options.format = 'y-m-d h:i:s');
    // @ts-ignore
    !options.timestamp && (options.timestamp = null);
    // @ts-ignore
    var date = options.timestamp === null ? new Date() : new Date(Number(options.timestamp)),
        y = date.getFullYear(),
        m = date.getMonth() + 1,
        d = date.getDate(),
        h = date.getHours(),
        i = date.getMinutes(),
        s = date.getSeconds();
    // @ts-ignore
    return options.format
    // @ts-ignore
    .replace(/y/g, String(y)).replace(/m/g, m < 10 ? '0' + m : m).replace(/d/g, d < 10 ? '0' + d : d).replace(/h/g, h < 10 ? '0' + h : h).replace(/i/g, i < 10 ? '0' + i : i).replace(/s/g, s < 10 ? '0' + s : s);
}
exports.parseDateTime = parseDateTime;

/***/ })

/******/ });
});
//# sourceMappingURL=h5-storage-cache.min.js.map